# BOMSyncTool ユーザーガイド

このドキュメントは、BOMSyncTool を利用して BOM の比較・前処理・エクスポートを行うための実務的な手順をまとめています。開発環境の構築については `docs/DEVELOPMENT.md` を参照してください。

> **より詳しい初心者向けマニュアル**: 機械操作に不慣れな方向けに、より丁寧に解説した `USER_MANUAL.md` もご用意しています。

## 1. はじめに

- **対応フォーマット**: CSV, XLSX, PADS ECO, CCF, MSF, PWS, BD, PADS Report
- **ターゲットユーザー**: 設計・部品管理担当、部品表の整備を行うエンジニア
- **保存場所**: プロジェクトと設定はローカルディスクに自動保存されます。バックアップは適宜取得してください。

## 2. 初回セットアップと起動

1. リポジトリを取得し、`npm install` で依存関係をインストール
2. `npm run tauri dev` でアプリを起動
3. バイナリが必要な場合は `npm run tauri build` で生成（`src-tauri/target/release/` 配下）
4. Windows / macOS 向け配布物は `bundle/` ディレクトリに出力されます

> **Tip:** Bun を利用する場合は `bun install`/`bun run tauri dev` に置き換え可能です。

## 3. プロジェクト管理

- 画面上部のタブがプロジェクト単位です。`+` アイコンで新規作成、タブ右端の `×` で削除できます。
- お気に入りへ登録すると左側のプロジェクトパネルにピン留めされ、頻繁に使う案件へ素早くアクセスできます。
- タブをドラッグして並び替えが可能です。同じプロジェクトを別ウィンドウで開く場合はタブメニューから「新しいウィンドウで開く」を選択します。
- プロジェクトはオートセーブされます。作業後にアプリを閉じても次回起動時に復元されます。

## 4. BOM の読み込み

1. 「Dataset A」「Dataset B」のドロップゾーンにファイルをドラッグ＆ドロップするか、ファイルピッカーから選択します。
2. 読み込み後、列役割（Ref / Part_No / Manufacturer）が自動推定されます。誤っている場合は列ヘッダのプルダウンで修正してください。
3. 複数レイヤーの BOM を扱う場合は、前処理や辞書を適用する前にプロジェクトを保存しておくと元データへ戻しやすくなります。

### 対応フォーマットの注意点

- **CSV / XLSX**: 文字コードは UTF-8 推奨。Excel 由来の全角スペースや改行は前処理で整形できます。
- **PADS ECO / CCF / MSF**: ネットリスト特有の列があるため、自動推定された列役割を確認してください。

## 5. 前処理ワークフロー

「前処理」ボタンを押すと、以下のブロックを組み合わせて適用できます。

- **Reference 展開**: `R1-R4` のような範囲指定を個別行へ分解
- **Reference 分割**: Reference と Suffix などを分割し、ソートしやすくする
- **空欄補完**: Part_No の欠損を既知値で埋める
- **テキストクリーニング**: 全角／半角変換、不要な記号除去など
- **書式整形**: 表示用の太字・取り消し線・セルカラーなど

適用ボタンを押すとモーダル内のプレビューが更新され、保存するまで元のデータセットには反映されません。複数ブロックを組み合わせる場合は適用順序に注意し、結果を確認してから保存してください。

## 6. 辞書管理

辞書タブでは登録名リストと例外リストを管理します。

- **登録名リスト**: `Part_No` や `Manufacturer` を指定の文字列へ置換
- **例外リスト**: 特定の Reference や部品のみ別のルールを適用
- **主な操作**:
  - 「辞書を読み込み」… 既存の辞書ファイル（JSON）を開く
  - 「辞書を書き出し」… 現在の辞書を JSON で保存
  - 「CSV インポート／エクスポート」… 表編集ツールでメンテしたい場合に使用
  - 「BOM から抽出」… 読み込んだ BOM をもとに辞書候補を作成
  - 「BOM に適用」… 現在のプロジェクトへ一括反映。適用後は自動保存されます

## 7. 差分比較と結果ビュー

1. 「比較」ボタンを押すと、追加／削除／変更／一致が色分けされた結果テーブルが表示されます。
2. 右上のフィルタで表示対象（例: 追加のみ）を切り替えられます。比較モードでは「すべて」「差分のみ」の2種類、置換モードでは「追加」「削除」「変更」を含む全てのフィルタが選択できます。
3. 「置換結果」タブでは、辞書や前処理後のマージ済み BOM を一覧できます。
4. Activity Log には主要な操作履歴が記録されます。必要に応じて「クリア」してください。

### 列表示コントロール

- 結果テーブルの上部にあるチェックボックスで、Ref／部品型番／メーカー列を個別に表示・非表示にできます。
- 「全表示」をオンにすると、追加で推論された列も含めて A/B 両方の値を一覧できます。比較対象の列を減らしたい場合は、必要な列だけオンにしてください。
- 置換モードでも同じコントロールが利用でき、必要な列だけで置き換え結果を確認できます。

## 8. エクスポートと印刷

- 結果テーブル右上の「エクスポート」で CSV / XLSX / ECO / CCF / MSF 形式を選択できます。フォーマットごとに必要な列が揃っているか確認してください。
- 置換結果をエクスポートする場合は、結果モードを「置換」に切り替えてから実行します。
- 「印刷」ボタンはブラウザの印刷ダイアログを開き、PDF 出力にも対応します。
- エクスポート先のパスはダイアログで選択します。テンプレートが必要なフォーマットは `templates/` 配下を参照してください。

## 9. トラブルシューティング

- **ファイルを読み込めない**: 拡張子と文字コードを確認し、Excel 形式の場合は一度 CSV で保存し直してください。
- **列役割がずれる**: 列ヘッダを手動で設定し、設定後にプロジェクトを保存して再読み込みしてください。
- **辞書適用後に値が消えた**: 元の BOM を再読み込みするか、辞書エントリの条件が意図通りか確認してください。
- **ビルドが失敗する**: Rust ツールチェーンと Tauri CLI が最新か確認し、`cargo tauri build` を直接実行してログを参照します。

### バグや問題の報告

予期しないエラーや動作不良が発生した場合は、GitHubリポジトリのIssuesページで報告してください：

1. リポジトリのIssuesタブにアクセス
2. 「New Issue」をクリック
3. 以下の情報を含めて報告：
   - 問題の内容（何をしようとしたか、どうなったか）
   - エラーメッセージ（表示された場合）
   - 使用環境（OS、BOMSyncToolのバージョン）
   - 再現手順（問題を再現するための具体的な操作）

開発者が問題を迅速に解決するために、できるだけ詳しい情報を記載していただけると助かります。

## 10. FAQ

- **Q. Bun は必須ですか？**  
  A. いいえ。npm だけでも動作します。Bun を使うと Tauri ビルドの準備が高速化します。

- **Q. プロジェクトデータはどこに保存されますか？**  
  A. アプリの設定ディレクトリ（OS ごとのユーザーデータフォルダ）に保存されます。バックアップは OS のユーザーデータを丸ごと取得してください。

- **Q. サンプル BOM はありますか？**  
  A. リポジトリには含めていません。社内標準データを利用するか、テスト用にダミー BOM を作成してください。

## 11. 付録

- **キーボードショートカット**: 今後追加予定です。
- **設定ファイル**: `src-tauri/capabilities/` でネイティブ権限を管理します。
- **ログ**: `bomsync_YYYY-MM-DD.log` がアプリと同じディレクトリに出力されます。

ドキュメントに不足があれば Issue や Pull Request でフィードバックをお願いします。
