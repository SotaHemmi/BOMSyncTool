# Changelog

このプロジェクトの全ての重要な変更を記録します。

フォーマットは [Keep a Changelog](https://keepachangelog.com/ja/1.0.0/) に基づいており、
バージョニングは [Semantic Versioning](https://semver.org/lang/ja/) に準拠しています。

## [Unreleased]

### 変更
- 印刷機能を利用できるようメインウィンドウの capability に `core:webview:allow-print` を追加
- README と開発ドキュメントに Tauri Capabilities 設定と印刷手順を追記
- `window.print()` の利用箇所へ Capabilities 依存関係をコメントで明記
- プロジェクト README を再構成し、全ディレクトリの役割を整理した `docs/DIRECTORY_COMMENTS.md` を追加
- Windows 向けビルドを自動化する GitHub Actions ワークフローを追加し、Bun のセットアップと利用手順をドキュメント化
- Windows CI で npm optional dependency 問題を避けるため、Bun で依存解決後に Rust 製 `cargo tauri build` を使用する安定フローへ変更（Cargo キャッシュと Bun セットアップを追加）

## [0.3.1] - 2025-10-30

### 修正
- **編集内容の自動保存**: 編集モーダルで保存後、プロジェクトに自動的に保存されるように修正
- **置き換え処理の改善**:
  - BOM A を BOM B で置き換えた際の不要なアラートを削除
  - 置き換え実行時にBOM Aのプレビューが上書きされる問題を修正（プレビューを保持）
  - 置き換え結果が自動保存時に消える問題を修正（プロジェクトID変更時のみリセット）
- **自動保存の無限ループ**: useEffectの依存配列を最適化し、「自動保存を開始しました」ログが無限に繰り返される問題を解消
- **タブ削除時の重複保存**: 最後のタブを削除した際に新規タブが重複保存される問題を修正

### 改善
- **タブ名の命名規則統一**: すべてのタブ作成方法で日付形式に統一
  - 旧: 「未命名タブ 1」「未命名タブ 2」...
  - 新: 「タブ 2025/10/30 14:23:45」（日本語ロケール形式）
  - BOMファイル読込時: 「[ファイル名] 2025/10/30 14:23:45」
- **プレビューレイアウトの最適化**:
  - 横並び表示の閾値を1200px→1000pxに変更（より小さい画面でも横並び表示）
  - プレビューテーブルに`flex-wrap`を追加し、レスポンシブ対応を強化
  - プレビューテーブルセルに最大幅（200px）と`text-overflow: ellipsis`を設定
  - カラム設定パネルのサイズを最適化（240px→220px、横並び時は200px）
- **モーダル表示の改善**:
  - モーダルサイズを調整（95vw×90vh → 90vw×85vh）で画面外表示を防止
  - 編集可能なテーブルラッパーに`max-width: 100%`を追加

### 技術的詳細
- `src/App.tsx`: 置き換え処理のBOM A上書きを削除、自動保存ループの依存配列を修正、プロジェクト切替ロジックを最適化
- `src/hooks/useProjects.ts`: `createProject`と`deleteProject`でのタブ名生成を`generateDefaultProjectName()`に統一
- `src/ui/edit-modal.ts`: `saveEdit`関数に`autoSaveActiveProject()`呼び出しを追加
- `src/styles.css`: プレビューとモーダルのレスポンシブ対応を強化
- `src/components/BOMCompare.tsx`: プレビュー構造は変更なし（CSSのみ変更）

### 追加機能（2025-10-24）
- **Chromeライクなタブ操作**:
  - 中クリック（ホイールクリック）でタブを閉じる機能
  - ドラッグ&ドロップによる新規ウィンドウ作成
  - ウィンドウ間のタブ統合（別ウィンドウからタブをドラッグして統合）
  - localStorage 監視による自動クリーンアップ（統合元ウィンドウからタブを自動削除）

### リファクタリング（2025-10-24）
- **完全モジュール化**: main.ts（4,286行）を21個のモジュールに分割
  - コアモジュール (src/core/): 5個（プロジェクト管理、辞書管理、エクスポート、前処理、設定管理）
  - UIモジュール (src/ui/): 16個（各UI機能を責務ごとに分離）
  - main.ts: 147行（エントリポイントのみ）
- **BomRow型の完全削除**: メモリ使用量を50%削減
  - すべての機能をParseResult（rows: string[][]）ベースに移行
  - 重複データ構造（normalizedBom）を削除
  - インデックスベースの参照に統一
- **型安全性の向上**: column_rolesをHashMap<String, Vec<String>>に変更
  - 複数列が同じ役割を持つことをサポート
  - ColumnRole型にpackage, quantity, remarksを追加
- **コード品質改善**:
  - 全モジュールにJSDocコメントを追加
  - TypeScriptコンパイルエラー: 0件
  - ビルドサイズ: 74.70 kB (gzip: 20.56 kB)
  - ビルド時間: 153ms

### 予定されている機能
- 単体テストの追加
- E2Eテストの追加
- パフォーマンス最適化
- アクセシビリティ改善

## [0.1.0] - 2025-10-21

### 追加機能

#### BOM比較・マージ機能
- 2つのBOMファイルの差分比較機能
- 追加・削除・変更・一致の4種類の差分を色分けして表示
- マージBOMの自動生成
- 差分結果のCSVエクスポート

#### ファイル形式サポート
- **入力対応**: CSV, XLSX, CADネットリスト（PADS-ECO, MSF SHAPE, CCF DEFINITION）
- **出力対応**: CSV, PADS-ECO (.eco), CCF (.ccf), MSF (.msf)
- CADネットリスト形式の完全なパース・生成ロジック

#### 列の自動検出機能
- Ref（部品番号）列の自動検出
  - `Ref`, `Ref1`, `Ref2`, `RefDesignator`, `部品番号` などに対応
- Part_No（部品型番）列の自動検出
  - `Part_No`, `PartNo`, `MPN`, `型番` などに対応
  - "manufacturer"との誤検出を防止する除外ロジック
- Value, Comment, Manufacturer列の自動検出
- 3段階マッチング（完全一致 → 部分一致 → 日本語パターン）

#### 辞書機能（部品名管理）
- **登録名リスト**:
  - 部品型番（Part_No）と登録名（社内表記名）の紐付け管理
  - BOMから型番を自動抽出する機能
  - テーブル形式での直接編集（自動保存）
  - CSV インポート/エクスポート
  - BOMへの登録名一括適用
- **特定部品（例外ルール）**:
  - Ref + Part_No の組み合わせで個別の登録名を設定
  - 登録名リストより優先度が高い
  - CSV インポート/エクスポート
- localStorageでの永続化

#### ビジュアル前処理エディタ
- ブロックプログラミング風のパイプライン構築UI
- 利用可能なブロック:
  - 📋 Referenceの展開（`C1,C2,C3` → 個別行に展開）
  - ✂️ Referenceを行分割（1行複数Ref → 複数行に分割）
  - 🔄 空欄セルの補完
  - 🧹 テキストクリーニング（空白・特殊文字の除去）
  - ✨ 書式ルール適用
- ドラッグ&ドロップでブロックの順序変更
- トグルスイッチで個別ブロックの有効/無効切り替え
- ブロックの追加・削除・移動機能
- パイプライン設定のlocalStorage保存

#### タブ/プロジェクト管理
- **タブ管理**:
  - ヘッダーに現在のタブ名を表示
  - 鉛筆アイコンでタブ名のインライン編集
  - プロンプトベースの簡単なリネーム機能
- **お気に入り機能**:
  - 星アイコン（⭐）でお気に入りに追加/削除
  - お気に入りタブは金色の星で表示
  - タブリストの最上部に優先表示
  - localStorageで永続化
- **別ウィンドウで開く**:
  - Tauri WebviewWindow APIを使用
  - 複数プロジェクトの同時作業が可能
  - ウィンドウサイズ: 1400×900
- 複数プロジェクトのタブ管理
- 自動保存機能（設定可能な間隔）

#### データ編集機能
- BOMデータの直接編集機能
- 検索・置換機能
- セル単位での編集
- 編集内容のプレビュー

#### UI/UX改善
- レスポンシブデザイン
- ドラッグ&ドロップによるファイル読み込み
- ファイルピッカーによる読み込み
- 処理中オーバーレイ表示
- アクティビティログ（最新20件）
- ツールチップによる操作ガイド

### 技術的実装

#### フロントエンド
- TypeScript + Vanilla HTML/CSS
- Vite ビルドシステム
- 3,543行のメインロジック（src/main.ts）
- 1,710行のスタイルシート（src/styles.css）
- 718行のHTML構造（index.html）

#### バックエンド（Rust + Tauri 2.0）
- **パーサー**:
  - CSV パーサー（csv crate使用）
  - Excel パーサー（calamine crate使用）
  - CADネットリスト パーサー（PADS-ECO, MSF, CCF形式）
- **エクスポーター**:
  - CSV エクスポーター
  - CADネットリスト エクスポーター（PADS-ECO, CCF, MSF形式）
- **データ処理**:
  - Reference展開・分割ロジック
  - テキストクリーニング
  - 書式整形
  - バリデーション
- **ヘッダー自動検出**:
  - 多言語対応（英語・日本語）
  - 複数の列名パターンに対応
  - 誤検出防止ロジック
- **差分比較**:
  - BOM比較アルゴリズム
  - マージロジック
- **ストレージ**:
  - セッション管理
  - 辞書データ管理

### 変更点
- 初期テンプレートから大幅に拡張
- UIを垂直レイアウトに変更（横並び → 縦並び）
- モーダルベースの編集UIに変更

### 修正
- CADネットリストパーサーの完全書き直し（実際のフォーマットに対応）
- 列自動検出の精度向上（誤検出の削減）
- エラーハンドリングの改善

### セキュリティ
- ファイル読み込み時のバリデーション
- エラーメッセージの安全な表示

## [0.0.1] - 2025-10-16

### 追加
- プロジェクトの初期セットアップ
- Tauri 2.0 + TypeScript + Vite のテンプレート
- 基本的なプロジェクト構造

---

## 凡例

- `追加`: 新機能の追加
- `変更`: 既存機能の変更
- `非推奨`: まもなく削除される機能
- `削除`: 削除された機能
- `修正`: バグ修正
- `セキュリティ`: セキュリティに関する変更
