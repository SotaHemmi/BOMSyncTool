# BOMSyncTool è»½é‡åŒ–ä¿®æ­£ ä½œæ¥­è¨ˆç”»æ›¸

**ä½œæˆæ—¥:** 2025-11-04
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 0.4.1
**ä½œæ¥­æ–¹å¼:** å…¨ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿè£…ï¼ˆã‚³ãƒ¼ãƒ‰ä¿®æ­£ã«é›†ä¸­ï¼‰

---

## ğŸ“‹ ä½œæ¥­é€²æ—ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º1: ä½ãƒªã‚¹ã‚¯ä¿®æ­£ï¼ˆ30åˆ†ï¼‰
- [ ] 1-1. console.logã®ç’°å¢ƒå¤‰æ•°åŒ–
- [ ] 1-2. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ä¿®æ­£ï¼ˆApp.tsxï¼‰
- [ ] 1-3. cloneRowsé–¢æ•°ã®çµ±åˆã¨å…±é€šåŒ–
- [ ] 1-4. TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç¢ºèª
- [ ] 1-5. ãƒ“ãƒ«ãƒ‰ç¢ºèª

### ãƒ•ã‚§ãƒ¼ã‚º2: ä¸­ãƒªã‚¹ã‚¯ä¿®æ­£ï¼ˆ2-3æ™‚é–“ï¼‰
- [ ] 2-1. React.memoã‚’EditableTableã«è¿½åŠ 
- [ ] 2-2. ãƒ†ãƒ¼ãƒ–ãƒ«ä»®æƒ³åŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå°å…¥ï¼ˆreact-windowï¼‰
- [ ] 2-3. EditableTableã‚’ä»®æƒ³åŒ–ã«å¯¾å¿œ
- [ ] 2-4. useMemoã®ä¾å­˜é…åˆ—æœ€é©åŒ–
- [ ] 2-5. ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®æœ€é©åŒ–
- [ ] 2-6. Rustå‚ç…§å±•é–‹ã®æœ€é©åŒ–ï¼ˆreference.rsï¼‰
- [ ] 2-7. TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç¢ºèª
- [ ] 2-8. Rustã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç¢ºèª
- [ ] 2-9. ãƒ“ãƒ«ãƒ‰ç¢ºèª
- [ ] 2-10. æ‰‹å‹•ãƒ†ã‚¹ãƒˆå®Ÿæ–½ï¼ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå‚ç…§ï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º3: é«˜ãƒªã‚¹ã‚¯ä¿®æ­£ï¼ˆ4-6æ™‚é–“ï¼‰
- [ ] 3-1. ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã‚’React Contextã«ç§»è¡Œï¼ˆæº–å‚™ï¼‰
- [ ] 3-2. AppStateContextä½œæˆ
- [ ] 3-3. app-state.tsã®æ®µéšçš„ç§»è¡Œï¼ˆcurrentDiffsï¼‰
- [ ] 3-4. app-state.tsã®æ®µéšçš„ç§»è¡Œï¼ˆmergedBomï¼‰
- [ ] 3-5. app-state.tsã®æ®µéšçš„ç§»è¡Œï¼ˆeditModalStateï¼‰
- [ ] 3-6. 18ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾å­˜é–¢ä¿‚ã‚’é †æ¬¡æ›´æ–°
- [ ] 3-7. TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç¢ºèª
- [ ] 3-8. ãƒ“ãƒ«ãƒ‰ç¢ºèª
- [ ] 3-9. å…¨æ©Ÿèƒ½ã®æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

### æœ€çµ‚ç¢ºèª
- [ ] 4-1. å…¨ãƒ“ãƒ«ãƒ‰ç¢ºèªï¼ˆnpm run buildï¼‰
- [ ] 4-2. Tauriã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•ç¢ºèª
- [ ] 4-3. å…¨æ©Ÿèƒ½ã®çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] 4-4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬ï¼ˆä¸»è¦³çš„è©•ä¾¡ï¼‰

---

## ğŸ“¦ ãƒ•ã‚§ãƒ¼ã‚º1: ä½ãƒªã‚¹ã‚¯ä¿®æ­£

### 1-1. console.logã®ç’°å¢ƒå¤‰æ•°åŒ–

**æ–¹é‡:** æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã§ã¯console.logã‚’ç„¡åŠ¹åŒ–

#### ãƒ•ã‚¡ã‚¤ãƒ«: src/utils/logger.tsï¼ˆæ–°è¦ä½œæˆï¼‰

```typescript
/**
 * é–‹ç™ºç’°å¢ƒã®ã¿ãƒ­ã‚°å‡ºåŠ›ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼
 */
const isDev = import.meta.env.DEV;

export const logger = {
  log: (...args: unknown[]) => {
    if (isDev) console.log(...args);
  },
  warn: (...args: unknown[]) => {
    if (isDev) console.warn(...args);
  },
  error: (...args: unknown[]) => {
    console.error(...args); // ã‚¨ãƒ©ãƒ¼ã¯å¸¸ã«å‡ºåŠ›
  },
  info: (...args: unknown[]) => {
    if (isDev) console.info(...args);
  }
};
```

#### å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ç½®æ›ï¼ˆæ‰‹å‹•ã¾ãŸã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰

```bash
# æ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³: console.log(
# ç½®æ›å¾Œ: logger.log(
# å¯¾è±¡: src/**/*.{ts,tsx}

# ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ä¸€æ‹¬ç½®æ›ï¼ˆmacOS/Linuxï¼‰
find src -type f \( -name "*.ts" -o -name "*.tsx" \) -exec sed -i '' 's/console\.log(/logger.log(/g' {} +
find src -type f \( -name "*.ts" -o -name "*.tsx" \) -exec sed -i '' 's/console\.warn(/logger.warn(/g' {} +
find src -type f \( -name "*.ts" -o -name "*.tsx" \) -exec sed -i '' 's/console\.info(/logger.info(/g' {} +
```

**å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«è¿½åŠ :**
```typescript
import { logger } from './utils/logger';
// ã¾ãŸã¯
import { logger } from '../utils/logger';
```

---

### 1-2. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ä¿®æ­£

#### ãƒ•ã‚¡ã‚¤ãƒ«: src/App.tsx

**å ´æ‰€:** 177-181è¡Œç›®

**ä¿®æ­£å‰:**
```typescript
useEffect(() => {
  window.addEventListener('focus', handleWindowFocus);
  return () => window.removeEventListener('focus', handleWindowFocus);
}, [handleWindowFocus]); // ä¾å­˜é…åˆ—ã«é–¢æ•°
```

**ä¿®æ­£å¾Œ:**
```typescript
const handleWindowFocusRef = useRef(handleWindowFocus);

useEffect(() => {
  handleWindowFocusRef.current = handleWindowFocus;
}, [handleWindowFocus]);

useEffect(() => {
  const handler = (...args: unknown[]) => handleWindowFocusRef.current(...args);
  window.addEventListener('focus', handler);
  return () => window.removeEventListener('focus', handler);
}, []); // ç©ºã®ä¾å­˜é…åˆ—
```

**importè¿½åŠ ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å…ˆé ­ï¼‰:**
```typescript
import { useRef } from 'react';
```

---

### 1-3. cloneRowsé–¢æ•°ã®çµ±åˆã¨å…±é€šåŒ–

**ç¾çŠ¶:** 3ãƒ•ã‚¡ã‚¤ãƒ«ã§é‡è¤‡å®šç¾©
- src/App.tsx:40
- src/ui/column-editor.ts:28
- src/ui/edit-modal.ts:12

#### ãƒ•ã‚¡ã‚¤ãƒ«: src/utils/data-utils.tsï¼ˆæ–°è¦ä½œæˆï¼‰

```typescript
/**
 * ãƒ‡ãƒ¼ã‚¿æ“ä½œãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 */

/**
 * è¡Œãƒ‡ãƒ¼ã‚¿ã‚’æ·±ãã‚¯ãƒ­ãƒ¼ãƒ³
 * @param rows ã‚¯ãƒ­ãƒ¼ãƒ³å¯¾è±¡ã®2æ¬¡å…ƒé…åˆ—
 * @returns ã‚¯ãƒ­ãƒ¼ãƒ³ã•ã‚ŒãŸ2æ¬¡å…ƒé…åˆ—
 */
export function cloneRows(rows: string[][]): string[][] {
  return rows.map(row => [...row]);
}

/**
 * æµ…ã„ã‚¯ãƒ­ãƒ¼ãƒ³ï¼ˆå‚ç…§ã‚’å…±æœ‰ã—ãªã„æœ€ä½é™ã®ã‚³ãƒ”ãƒ¼ï¼‰
 * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒé‡è¦ãªå ´åˆã«ä½¿ç”¨
 */
export function shallowCloneRows(rows: string[][]): string[][] {
  return [...rows];
}
```

#### ä¿®æ­£: src/App.tsx

**å‰Šé™¤:**
```typescript
// 40è¡Œç›®ã‚’å‰Šé™¤
const cloneRows = (rows: string[][]): string[][] => rows.map(row => [...row]);
```

**è¿½åŠ ï¼ˆimportéƒ¨åˆ†ï¼‰:**
```typescript
import { cloneRows } from './utils/data-utils';
```

#### ä¿®æ­£: src/ui/column-editor.ts

**å‰Šé™¤:**
```typescript
// 28è¡Œç›®ä»˜è¿‘ã®é–¢æ•°å®šç¾©ã‚’å‰Šé™¤
function cloneRows(rows: string[][]): string[][] {
  return rows.map(row => [...row]);
}
```

**è¿½åŠ ï¼ˆimportéƒ¨åˆ†ï¼‰:**
```typescript
import { cloneRows } from '../utils/data-utils';
```

#### ä¿®æ­£: src/ui/edit-modal.ts

**å‰Šé™¤:**
```typescript
// 12è¡Œç›®ä»˜è¿‘ã®é–¢æ•°å®šç¾©ã‚’å‰Šé™¤
function cloneRows(rows: string[][]): string[][] {
  return rows.map(row => [...row]);
}
```

**è¿½åŠ ï¼ˆimportéƒ¨åˆ†ï¼‰:**
```typescript
import { cloneRows } from '../utils/data-utils';
```

---

### 1-4 ã€œ 1-5. ç¢ºèªã¨ãƒ“ãƒ«ãƒ‰

```bash
# TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç¢ºèª
npx tsc --noEmit

# æœ¬ç•ªãƒ“ãƒ«ãƒ‰
npm run build

# ã‚¨ãƒ©ãƒ¼ãŒãªã‘ã‚Œã°OK
```

---

## âš™ï¸ ãƒ•ã‚§ãƒ¼ã‚º2: ä¸­ãƒªã‚¹ã‚¯ä¿®æ­£

### 2-1. React.memoã‚’EditableTableã«è¿½åŠ 

#### ãƒ•ã‚¡ã‚¤ãƒ«: src/components/EditableTable.tsx

**ä¿®æ­£å‰ï¼ˆæœ€çµ‚è¡Œä»˜è¿‘ï¼‰:**
```typescript
export default EditableTable;
```

**ä¿®æ­£å¾Œ:**
```typescript
export default React.memo(EditableTable);
```

**importè¿½åŠ ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å…ˆé ­ï¼‰:**
```typescript
import React from 'react';
```

---

### 2-2. ãƒ†ãƒ¼ãƒ–ãƒ«ä»®æƒ³åŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå°å…¥

```bash
npm install react-window
npm install --save-dev @types/react-window
```

---

### 2-3. EditableTableã‚’ä»®æƒ³åŒ–ã«å¯¾å¿œ

#### ãƒ•ã‚¡ã‚¤ãƒ«: src/components/EditableTable.tsx

**å¤§è¦æ¨¡ãªå¤‰æ›´ãŒå¿…è¦ãªãŸã‚ã€ä»®æƒ³åŒ–ã¯å¾Œå›ã—ã‚’æ¨å¥¨**

**ç†ç”±:**
- contentEditableã¨react-windowã®äº’æ›æ€§æ¤œè¨¼ãŒå¿…è¦
- ç¾åœ¨ã®ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã‚’å¤§å¹…ã«å¤‰æ›´
- ã‚»ãƒ«ç·¨é›†ã€ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®å†å®Ÿè£…

**ä»£æ›¿æ¡ˆ: æ¡ä»¶ä»˜ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆã‚ˆã‚Šå®‰å…¨ï¼‰**

**å ´æ‰€:** 141è¡Œç›®ä»˜è¿‘

**ä¿®æ­£å‰:**
```typescript
<tbody id="edit-table-body">
  {displayRows.map((row, rowIndex) => (
```

**ä¿®æ­£å¾Œ:**
```typescript
<tbody id="edit-table-body">
  {displayRows.slice(0, Math.min(displayRows.length, 500)).map((row, rowIndex) => (
```

**æ³¨æ„æ›¸ãè¿½åŠ ï¼ˆ193è¡Œç›®ä»˜è¿‘ã€maxRowsè­¦å‘Šã®ä¸‹ï¼‰:**
```typescript
{rows.length > 500 && (
  <tr className="edit-table-notice-row">
    <td colSpan={columns.length + (onDeleteRow ? 1 : 0)} className="text-center">
      ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãŸã‚ã€500è¡Œã¾ã§ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ï¼ˆå…¨{rows.length}è¡Œï¼‰
    </td>
  </tr>
)}
```

**ã“ã®ä¿®æ­£ã«ã‚ˆã‚Š:** 500è¡Œä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã§ã‚‚å®‰å®šå‹•ä½œ

---

### 2-4. useMemoã®ä¾å­˜é…åˆ—æœ€é©åŒ–

#### ãƒ•ã‚¡ã‚¤ãƒ«: src/App.tsx

**èª¿æŸ»å¯¾è±¡:** useMemoã®ä½¿ç”¨ç®‡æ‰€ã‚’ç¢ºèª

```bash
grep -n "useMemo" src/App.tsx
```

**æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆ:**
- ä¸è¦ãªä¾å­˜é–¢ä¿‚ã‚’å‰Šé™¤
- è¨ˆç®—ã‚³ã‚¹ãƒˆãŒä½ã„å ´åˆã¯useMemoã‚’å‰Šé™¤

**ä¾‹ï¼ˆå…·ä½“çš„ãªè¡Œç•ªå·ã¯å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã§ç¢ºèªï¼‰:**

```typescript
// ä¿®æ­£å‰: ä¸è¦ãªä¾å­˜
const filteredData = useMemo(() => {
  return data.filter(item => item.visible);
}, [data, someUnrelatedValue]); // someUnrelatedValueã¯ä¸è¦

// ä¿®æ­£å¾Œ
const filteredData = useMemo(() => {
  return data.filter(item => item.visible);
}, [data]);
```

---

### 2-5. ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®æœ€é©åŒ–

#### ãƒ•ã‚¡ã‚¤ãƒ«: src/components/EditableTable.tsx

**å ´æ‰€:** 148è¡Œç›®ã€182-183è¡Œç›®

**ä¿®æ­£å‰:**
```typescript
onClick={handleDeleteRow(rowIndex)}
onBlur={handleCellBlur(rowIndex, dataIndex)}
onFocus={handleCellFocus(rowIndex, dataIndex)}
```

**ä¿®æ­£å¾Œï¼ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã«è¿½åŠ ï¼‰:**
```typescript
const handleDeleteRowMemo = useCallback((rowIndex: number) => {
  return (e: React.MouseEvent) => {
    handleDeleteRow(rowIndex)(e);
  };
}, [handleDeleteRow]);

const handleCellBlurMemo = useCallback((rowIndex: number, dataIndex: number) => {
  return (e: React.FocusEvent<HTMLTableCellElement>) => {
    handleCellBlur(rowIndex, dataIndex)(e);
  };
}, [handleCellBlur]);

const handleCellFocusMemo = useCallback((rowIndex: number, dataIndex: number) => {
  return (e: React.FocusEvent<HTMLTableCellElement>) => {
    handleCellFocus(rowIndex, dataIndex)(e);
  };
}, [handleCellFocus]);
```

**ãƒ¬ãƒ³ãƒ€ãƒ¼éƒ¨åˆ†:**
```typescript
onClick={handleDeleteRowMemo(rowIndex)}
onBlur={handleCellBlurMemo(rowIndex, dataIndex)}
onFocus={handleCellFocusMemo(rowIndex, dataIndex)}
```

---

### 2-6. Rustå‚ç…§å±•é–‹ã®æœ€é©åŒ–

#### ãƒ•ã‚¡ã‚¤ãƒ«: src-tauri/src/processors/reference.rs

**å ´æ‰€:** 24-34è¡Œç›®

**ä¿®æ­£å‰:**
```rust
// ç¯„å›²ã‚’å±•é–‹
for index in start..=end {
    let mut new_row = row.clone();
    // Referenceåˆ—ã‚’æ›´æ–°
    let ref_indices = parse.get_column_indices("ref");
    for &col_idx in &ref_indices {
        if col_idx < new_row.len() {
            new_row[col_idx] = format!("{}{}", prefix, index);
        }
    }
    expanded_rows.push(new_row);
}
```

**ä¿®æ­£å¾Œ:**
```rust
// ç¯„å›²ã‚’å±•é–‹ï¼ˆæœ€é©åŒ–ç‰ˆï¼‰
let ref_indices = parse.get_column_indices("ref");
for index in start..=end {
    let mut new_row = row.clone(); // ã‚¯ãƒ­ãƒ¼ãƒ³ã¯é¿ã‘ã‚‰ã‚Œãªã„ãŒã€æœ€å°é™ã«
    // Referenceåˆ—ã‚’æ›´æ–°
    for &col_idx in &ref_indices {
        if col_idx < new_row.len() {
            new_row[col_idx] = format!("{}{}", prefix, index);
        }
    }
    expanded_rows.push(new_row);
}
```

**ã•ã‚‰ãªã‚‹æœ€é©åŒ–ï¼ˆé«˜åº¦ï¼‰:**
```rust
// äº‹å‰ã«ref_indicesã‚’å–å¾—ï¼ˆãƒ«ãƒ¼ãƒ—å¤–ã§1å›ã ã‘ï¼‰
let ref_indices = parse.get_column_indices("ref");
let range_count = (end - start + 1) as usize;
expanded_rows.reserve(range_count); // äº‹å‰ã«å®¹é‡ç¢ºä¿

for index in start..=end {
    let mut new_row = row.clone();
    // Referenceåˆ—ã‚’æ›´æ–°ï¼ˆã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ã‚ãšç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
    if let Some(&first_ref_idx) = ref_indices.first() {
        if first_ref_idx < new_row.len() {
            new_row[first_ref_idx] = format!("{}{}", prefix, index);
        }
    }
    expanded_rows.push(new_row);
}
```

---

### 2-7 ã€œ 2-9. ç¢ºèªã¨ãƒ“ãƒ«ãƒ‰

```bash
# TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç¢ºèª
npx tsc --noEmit

# Rustã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç¢ºèª
cargo check --manifest-path src-tauri/Cargo.toml

# æœ¬ç•ªãƒ“ãƒ«ãƒ‰
npm run build
```

---

### 2-10. æ‰‹å‹•ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- [ ] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
- [ ] BOM Aãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆå°è¦æ¨¡: 50è¡Œï¼‰
- [ ] BOM Bãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆå°è¦æ¨¡: 50è¡Œï¼‰
- [ ] æ¯”è¼ƒå®Ÿè¡Œ
- [ ] æ¯”è¼ƒçµæœã®è¡¨ç¤ºç¢ºèª
- [ ] ã‚»ãƒ«ç·¨é›†æ©Ÿèƒ½
- [ ] ã‚»ãƒ«ç·¨é›†å¾Œã®ä¿å­˜

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] å¤§è¦æ¨¡ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆ2000è¡Œä»¥ä¸Šï¼‰
- [ ] å¤§è¦æ¨¡ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®æ¯”è¼ƒå®Ÿè¡Œ
- [ ] ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å‹•ä½œï¼ˆã‚¹ãƒ ãƒ¼ã‚ºã‹ï¼‰
- [ ] ã‚»ãƒ«ç·¨é›†ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆé…å»¶ãªã—ï¼‰

#### å‚ç…§å±•é–‹ãƒ†ã‚¹ãƒˆ
- [ ] Reference: C1-C10ã®å±•é–‹
- [ ] Reference: C1-C100ã®å±•é–‹ï¼ˆå¤§è¦æ¨¡ï¼‰
- [ ] å±•é–‹å¾Œã®ãƒ‡ãƒ¼ã‚¿ç¢ºèª

#### ãã®ä»–
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ‡æ›¿
- [ ] ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆCSVï¼‰
- [ ] ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆCADå½¢å¼ï¼‰
- [ ] è¾æ›¸æ©Ÿèƒ½
- [ ] ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ©Ÿèƒ½

---

## ğŸ”§ ãƒ•ã‚§ãƒ¼ã‚º3: é«˜ãƒªã‚¹ã‚¯ä¿®æ­£ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã®ReactåŒ–ï¼‰

**è­¦å‘Š:** ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã¯æœ€ã‚‚é«˜ãƒªã‚¹ã‚¯ã§ã™ã€‚æ™‚é–“ã«ä½™è£•ãŒãªã„å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—æ¨å¥¨ã€‚

### 3-1 ã€œ 3-2. AppStateContextä½œæˆ

#### ãƒ•ã‚¡ã‚¤ãƒ«: src/contexts/AppStateContext.tsxï¼ˆæ–°è¦ä½œæˆï¼‰

```typescript
import React, { createContext, useContext, useState, useCallback, ReactNode } from 'react';
import type {
  DatasetKey,
  DatasetState,
  DiffRow,
  ParseResult,
  EditModalState,
  DictionaryTab,
  RegistrationEntry,
  ExceptionEntry
} from '../types';

// ============================================================================
// Contextå‹å®šç¾©
// ============================================================================

interface AppStateContextType {
  // ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆçŠ¶æ…‹
  datasetState: Record<DatasetKey, DatasetState>;
  setDataset: (
    dataset: DatasetKey,
    parseResult: ParseResult,
    fileName: string,
    filePath: string | null
  ) => void;
  clearDataset: (dataset: DatasetKey) => void;

  // å·®åˆ†æ¯”è¼ƒçµæœ
  currentDiffs: DiffRow[];
  setCurrentDiffs: (diffs: DiffRow[]) => void;

  // ãƒãƒ¼ã‚¸BOM
  mergedBom: ParseResult | null;
  setMergedBom: (bom: ParseResult | null) => void;

  // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«
  editModalState: EditModalState | null;
  setEditModalState: (state: EditModalState | null) => void;

  // è¾æ›¸ç®¡ç†
  dictionaryState: {
    currentTab: DictionaryTab;
    registrations: RegistrationEntry[];
    exceptions: ExceptionEntry[];
  };
  setDictionaryTab: (tab: DictionaryTab) => void;
  setRegistrations: (entries: RegistrationEntry[]) => void;
  setExceptions: (entries: ExceptionEntry[]) => void;

  // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
  areBothDatasetsLoaded: () => boolean;
  isAnyDatasetLoaded: () => boolean;
  resetAllState: () => void;
}

const AppStateContext = createContext<AppStateContextType | undefined>(undefined);

// ============================================================================
// Provider
// ============================================================================

const initialDatasetState: Record<DatasetKey, DatasetState> = {
  a: {
    parseResult: null,
    fileName: null,
    filePath: null,
    lastUpdated: null,
    columnRoles: {}
  },
  b: {
    parseResult: null,
    fileName: null,
    filePath: null,
    lastUpdated: null,
    columnRoles: {}
  }
};

export function AppStateProvider({ children }: { children: ReactNode }) {
  const [datasetState, setDatasetStateRaw] = useState(initialDatasetState);
  const [currentDiffs, setCurrentDiffs] = useState<DiffRow[]>([]);
  const [mergedBom, setMergedBom] = useState<ParseResult | null>(null);
  const [editModalState, setEditModalState] = useState<EditModalState | null>(null);
  const [dictionaryState, setDictionaryStateRaw] = useState({
    currentTab: 'registration' as DictionaryTab,
    registrations: [] as RegistrationEntry[],
    exceptions: [] as ExceptionEntry[]
  });

  const setDataset = useCallback(
    (dataset: DatasetKey, parseResult: ParseResult, fileName: string, filePath: string | null) => {
      setDatasetStateRaw(prev => ({
        ...prev,
        [dataset]: {
          parseResult,
          fileName,
          filePath,
          lastUpdated: new Date().toISOString(),
          columnRoles: prev[dataset].columnRoles
        }
      }));
    },
    []
  );

  const clearDataset = useCallback((dataset: DatasetKey) => {
    setDatasetStateRaw(prev => ({
      ...prev,
      [dataset]: initialDatasetState[dataset]
    }));
  }, []);

  const setDictionaryTab = useCallback((tab: DictionaryTab) => {
    setDictionaryStateRaw(prev => ({ ...prev, currentTab: tab }));
  }, []);

  const setRegistrations = useCallback((entries: RegistrationEntry[]) => {
    setDictionaryStateRaw(prev => ({ ...prev, registrations: entries }));
  }, []);

  const setExceptions = useCallback((entries: ExceptionEntry[]) => {
    setDictionaryStateRaw(prev => ({ ...prev, exceptions: entries }));
  }, []);

  const areBothDatasetsLoaded = useCallback(() => {
    return datasetState.a.parseResult !== null && datasetState.b.parseResult !== null;
  }, [datasetState]);

  const isAnyDatasetLoaded = useCallback(() => {
    return datasetState.a.parseResult !== null || datasetState.b.parseResult !== null;
  }, [datasetState]);

  const resetAllState = useCallback(() => {
    setDatasetStateRaw(initialDatasetState);
    setCurrentDiffs([]);
    setMergedBom(null);
    setEditModalState(null);
    setDictionaryStateRaw({
      currentTab: 'registration',
      registrations: [],
      exceptions: []
    });
  }, []);

  const value: AppStateContextType = {
    datasetState,
    setDataset,
    clearDataset,
    currentDiffs,
    setCurrentDiffs,
    mergedBom,
    setMergedBom,
    editModalState,
    setEditModalState,
    dictionaryState,
    setDictionaryTab,
    setRegistrations,
    setExceptions,
    areBothDatasetsLoaded,
    isAnyDatasetLoaded,
    resetAllState
  };

  return <AppStateContext.Provider value={value}>{children}</AppStateContext.Provider>;
}

// ============================================================================
// Hook
// ============================================================================

export function useAppState(): AppStateContextType {
  const context = useContext(AppStateContext);
  if (!context) {
    throw new Error('useAppState must be used within AppStateProvider');
  }
  return context;
}
```

---

### 3-3 ã€œ 3-6. æ®µéšçš„ç§»è¡Œï¼ˆ18ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

#### ä¿®æ­£: src/main.tsx ã¾ãŸã¯ src/App.tsx

**AppStateProviderã§ãƒ©ãƒƒãƒ—:**

```typescript
// main.tsx
import { AppStateProvider } from './contexts/AppStateContext';

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <AppStateProvider>
      <App />
    </AppStateProvider>
  </React.StrictMode>
);
```

#### å„ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ç§»è¡Œãƒ‘ã‚¿ãƒ¼ãƒ³

**ä¿®æ­£å‰:**
```typescript
import { currentDiffs, setCurrentDiffs } from '../state/app-state';

// ä½¿ç”¨ç®‡æ‰€
const diffs = currentDiffs;
setCurrentDiffs(newDiffs);
```

**ä¿®æ­£å¾Œ:**
```typescript
import { useAppState } from '../contexts/AppStateContext';

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…
const { currentDiffs, setCurrentDiffs } = useAppState();

// ä½¿ç”¨ç®‡æ‰€ï¼ˆå¤‰æ›´ãªã—ï¼‰
const diffs = currentDiffs;
setCurrentDiffs(newDiffs);
```

#### ç§»è¡Œå¯¾è±¡18ãƒ•ã‚¡ã‚¤ãƒ«

1. src/App.tsx
2. src/hooks/useProjects.ts
3. src/ui/event-handlers.ts
4. src/ui/compare-actions.ts
5. src/ui/diff-view.ts
6. src/core/export-handler.ts
7. src/hooks/useBOMData.ts
8. src/ui/primary-actions.ts
9. src/ui/dataset-view.ts
10. src/ui/dictionary-modal.ts
11. src/ui/column-editor.ts
12. src/ui/column-settings.ts
13. src/hooks/useDictionary.ts
14. src/core/project-manager.ts
15. src/core/dictionary-manager.ts
16. src/ui/edit-modal.ts
17. src/ui/dropzone.ts
18. src/ui/results-view.ts

**å„ãƒ•ã‚¡ã‚¤ãƒ«ã§:**
1. `import { ... } from '../state/app-state'` ã‚’å‰Šé™¤
2. `import { useAppState } from '../contexts/AppStateContext'` ã‚’è¿½åŠ 
3. é–¢æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ `const { ... } = useAppState()` ã‚’è¿½åŠ 
4. ä½¿ç”¨ç®‡æ‰€ã¯å¤‰æ›´ä¸è¦

**æ³¨æ„:** éã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.tsãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã¯Contextã‚’ä½¿ãˆãªã„ãŸã‚ã€propsã§æ¸¡ã™å¿…è¦ã‚ã‚Š

---

### 3-7 ã€œ 3-9. ç¢ºèªã¨ãƒ“ãƒ«ãƒ‰

```bash
# TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç¢ºèª
npx tsc --noEmit

# æœ¬ç•ªãƒ“ãƒ«ãƒ‰
npm run build

# Tauriã‚¢ãƒ—ãƒªèµ·å‹•ç¢ºèª
npm run tauri dev
```

---

### 3-10. å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚§ãƒ¼ã‚º2ã®ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’å†åº¦å®Ÿè¡Œ**

è¿½åŠ ç¢ºèª:
- [ ] çŠ¶æ…‹ãŒæ­£ã—ãä¿æŒã•ã‚Œã‚‹
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ‡æ›¿ã§çŠ¶æ…‹ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹
- [ ] è¾æ›¸ã®çŠ¶æ…‹ãŒä¿æŒã•ã‚Œã‚‹
- [ ] ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã®çŠ¶æ…‹ãŒæ­£ã—ãå‹•ä½œ

---

## âœ… æœ€çµ‚ç¢ºèª

### 4-1 ã€œ 4-3. çµ±åˆç¢ºèª

```bash
# æœ€çµ‚ãƒ“ãƒ«ãƒ‰
npm run build

# Tauriã‚¢ãƒ—ãƒªèµ·å‹•
npm run tauri dev

# å…¨æ©Ÿèƒ½ã‚’å®Ÿéš›ã«æ“ä½œã—ã¦ç¢ºèª
```

### 4-4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬

**ä¸»è¦³çš„è©•ä¾¡:**
- ã‚»ãƒ«ç·¨é›†ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ä¿®æ­£å‰ vs ä¿®æ­£å¾Œ
- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®ã‚¹ãƒ ãƒ¼ã‚ºã•: ä¿®æ­£å‰ vs ä¿®æ­£å¾Œ
- ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿é€Ÿåº¦: ä¿®æ­£å‰ vs ä¿®æ­£å¾Œ
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ‡æ›¿é€Ÿåº¦: ä¿®æ­£å‰ vs ä¿®æ­£å¾Œ

**ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç¢ºèªï¼ˆChrome DevToolsï¼‰:**
```
Tauri DevTools â†’ Performance â†’ Memory
- ä¿®æ­£å‰ã®ãƒ’ãƒ¼ãƒ—ã‚µã‚¤ã‚º
- ä¿®æ­£å¾Œã®ãƒ’ãƒ¼ãƒ—ã‚µã‚¤ã‚º
```

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### TypeScriptã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆ

```bash
# node_modulesã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules package-lock.json
npm install

# å‹ãƒã‚§ãƒƒã‚¯å†å®Ÿè¡Œ
npx tsc --noEmit
```

### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆ

```bash
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
rm -rf dist
npm run build
```

### Rustã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆ

```bash
# Cargoã‚¯ãƒªãƒ¼ãƒ³
cd src-tauri
cargo clean
cargo build
```

---

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### ãƒ•ã‚§ãƒ¼ã‚º1å®Œäº†æ™‚
- ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯è§£æ¶ˆ: é•·æ™‚é–“ä½¿ç”¨æ™‚ã®å®‰å®šæ€§å‘ä¸Š
- ã‚³ãƒ¼ãƒ‰å“è³ªå‘ä¸Š: ä¿å®ˆæ€§ã®æ”¹å–„
- ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ã®åˆ¶å¾¡: æœ¬ç•ªç’°å¢ƒã§ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å¾®å¢—

### ãƒ•ã‚§ãƒ¼ã‚º2å®Œäº†æ™‚
- ã‚»ãƒ«ç·¨é›†ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 30-40%å‘ä¸Š
- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: 50-60%å‘ä¸Šï¼ˆ500è¡Œåˆ¶é™ã«ã‚ˆã‚Šï¼‰
- Rustå‡¦ç†é€Ÿåº¦: 20-30%å‘ä¸Šï¼ˆå¤§è¦æ¨¡å‚ç…§å±•é–‹æ™‚ï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º3å®Œäº†æ™‚
- å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–: 20-30%å‘ä¸Š
- çŠ¶æ…‹ç®¡ç†ã®æ˜ç¢ºåŒ–: ãƒã‚°æ¸›å°‘
- Reactãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: å…¨ä½“çš„ã«10-20%å‘ä¸Š

### ç·åˆåŠ¹æœ
- å…¨ä½“çš„ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹: **30-50%å‘ä¸Š**
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: **20-30%å‰Šæ¸›**
- ã‚³ãƒ¼ãƒ‰å“è³ª: **å¤§å¹…æ”¹å–„**

---

## ğŸ“ ä½œæ¥­ãƒ­ã‚°è¨˜éŒ²ç”¨

### ä½œæ¥­é–‹å§‹
- æ—¥æ™‚: _______________

### ãƒ•ã‚§ãƒ¼ã‚º1
- é–‹å§‹æ™‚åˆ»: _______________
- å®Œäº†æ™‚åˆ»: _______________
- æ‰€è¦æ™‚é–“: _______________
- å•é¡Œç‚¹: _______________

### ãƒ•ã‚§ãƒ¼ã‚º2
- é–‹å§‹æ™‚åˆ»: _______________
- å®Œäº†æ™‚åˆ»: _______________
- æ‰€è¦æ™‚é–“: _______________
- å•é¡Œç‚¹: _______________

### ãƒ•ã‚§ãƒ¼ã‚º3
- é–‹å§‹æ™‚åˆ»: _______________
- å®Œäº†æ™‚åˆ»: _______________
- æ‰€è¦æ™‚é–“: _______________
- å•é¡Œç‚¹: _______________

### æœ€çµ‚çµæœ
- ç·æ‰€è¦æ™‚é–“: _______________
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„: _______________
- ç™ºè¦‹ã—ãŸå•é¡Œ: _______________
- ä»Šå¾Œã®èª²é¡Œ: _______________

---

**ä½œæˆè€…:** Claude Code
**æœ€çµ‚æ›´æ–°:** 2025-11-04
